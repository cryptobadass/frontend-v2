<script lang="ts" setup>
import { computed } from 'vue';
import { getActiveClassName } from '@/components/utils';
import { StepState } from '@/types';

type Props = {
  title: string;
  steps: Step[];
};

type Step = {
  tooltip: string;
  state: StepState;
  label: number;
  isVisible?: boolean;
};

const props = defineProps<Props>();
const emit = defineEmits(['navigate']);

/**
 * COMPUTED
 */
const visibleSteps = computed(() => {
  return props.steps.filter(
    step => step.isVisible === undefined || step.isVisible
  );
});

const stepTextClasses = computed(() => {
  return visibleSteps.value.map(step => {
    return getActiveClassName(step.state, [
      [StepState.Active, 'text-white font-semibold hover:text-cyan'],
      [StepState.Todo, 'text-blueyGrey font-normal'],
      [StepState.Success, 'text-green-500 font-semibold'],
      [StepState.Warning, 'text-red-500 font-semibold'],
      [StepState.Completed, 'text-gray-700 font-medium']
    ]);
  });
});

const stepCircleClasses = computed(() => {
  return visibleSteps.value.map(step => {
    return getActiveClassName(step.state, [
      [
        StepState.Active,
        'border-2 border-none bg-cyan from-blue-600 to-blue-50 text-dark active'
      ],
      [
        StepState.Todo,
        'border border-gunmetal  dark:border-gunmetal bg-dark-3 text-white'
      ],
      [
        StepState.Success,
        'border-1 border-none bg-gradient-to-tr from-green-500 to-green-200 text-white'
      ],
      [StepState.Warning, 'border-2 border-none bg-red-500 text-white active'],
      [StepState.Completed, 'border-2 border-gray-600 font-medium']
    ]);
  });
});

/**
 * FUNCTIONS
 */
function handleNavigate(state: StepState, stepIndex: number) {
  if (state === StepState.Todo) return;
  emit('navigate', stepIndex);
}
</script>

<template>
  <BalCard noPad noBorder shadow="none">
    <!-- <div class="p-4 border-b dark:border-gray-600">
      <h6 class="dark:text-gray-300">{{ title }}</h6>
    </div> -->
    <BalStack
      horizontal
      spacing="none"
      spacingClass="spacing"
      class="p-4"
      justify="between"
    >
      <div
        v-for="(step, i) in visibleSteps"
        :key="`vertical-step-${step.tooltip}`"
        class="flex items-center"
      >
        <button
          @click="handleNavigate(step.state, i)"
          :class="{ 'cursor-default': step.state === StepState.Todo }"
        >
          <BalStack horizontal align="center" spacing="sm">
            <div
              :class="[
                'relative text-sm rounded-full w-7 h-7 flex justify-center items-center',
                stepCircleClasses[i]
              ]"
            >
              <div
                class="absolute top-0 left-0 right-0 bottom-0 w-4 mx-auto flex justify-center items-center"
              >
                <span
                  v-if="
                    ![StepState.Warning, StepState.Error].includes(step.state)
                  "
                  >{{ step.label || i + 1 }}</span
                >
                <span class="font-bold" v-else>!</span>
              </div>
            </div>
            <span
              :class="[
                'text-sm',
                stepTextClasses[i],
                { 'circle-line': i !== visibleSteps.length - 1 }
              ]"
            >
              {{ step.tooltip }}
            </span>
          </BalStack>
        </button>
        <!-- <div class=" w-10 border-b"></div> -->
      </div>
    </BalStack>
  </BalCard>
</template>

<style scoped>
.circle-line::after {
  @apply absolute left-0 right-0 my-0 mx-auto bg-gray-300 dark:bg-gray-600 w-px;
  content: '';
  bottom: -1.125rem;
  height: 1rem;
}

.circle-line.active::after {
  bottom: -1rem;
  height: 1rem;
}
.spacing::after {
  content: '';
  width: 10rem;
  @apply border-b border-gunmetal mx-1;
}
</style>
